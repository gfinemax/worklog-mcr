# MBC PLUS MCR 디지털 업무일지 시스템 - 제품 요구사항 정의서 (PRD)

## 1. 시스템 개요
**MCR 디지털 업무일지 시스템**은 MBC PLUS의 방송 운행 및 송출 업무를 효율적으로 관리하기 위한 웹 기반 플랫폼입니다. 기존의 수기 업무일지를 디지털화하여 데이터의 정확성을 높이고, 실시간 모니터링, AI 기반 요약, 통계 분석 기능을 제공합니다.

## 2. 사용자 및 스태프 관리

### 2.1 사용자 인증 및 역할
- **인증**: JWT 기반 (Access 24h, Refresh 7d).
- **역할 (Role)**:
  - `Main_director`: 주조감독 (총괄)
  - `Sub_director`: CMS감독
  - `Backup_director`: 예비감독
  - `tech_staff`: 영상감독
  - `admin`: 시스템 관리자

### 2.2 유연한 스태프 관리 (New)
- **WorklogStaff 모델**: 정식 사용자(`User`)와 외부 인원(`ExternalStaff`) 모두를 업무일지의 스태프로 등록 가능.
- **역할 부여**: `  Main_director`, `Sub_director`, `Backup_director`, `tech_staff` 등의 역할을 스태프 등록 시 지정.

### 2.3 팀 관리 (New)
- **Team 모델**: 팀의 추가, 이름 변경, 삭제가 용이한 별도 모델 운영.

## 3. 업무일지 관리

### 3.1 업무일지 관리
- **기본 정보**
  - **근무일 기준**: 당일 07:30 ~ 익일 07:30 (24시간 기준).
  - **일지 작성 원칙**: 1일 기준(07:30~익일 07:30)으로 **A근무 일지**와 **N근무 일지**가 각각 작성됨.
  야간 근무(18:30 ~ 익일 07:30)가 이틀에 걸쳐 있어도, '활성화된 업무일지' 판단 로직을 통해 모든 메모가 정확한 업무 기준일의 일지에 귀속됨.
  - **팀 구성**: 각 팀당 3~4명 (기본 3명 + 상황에 따라 1명 추가).
  - **근무 패턴 (ANSYY 5일 주기)**:
    - **A (Day)**: 주간 근무 (07:30 ~ 19:00).
    - **N (Night)**: 야간 근무 (18:30 ~ 08:00 익일). *통상 'NS'로 지칭*.
    - **S (Sleep)**: 야간 근무 종료일 (휴식).
    - **Y (Off)**: 휴무.
    - **Y (Off)**: 휴무.
  - **근무조 운영 (10개 팀 순환)**:
    - 10개 팀이 5일 주기의 패턴을 순환하며 근무.
    - 예시:
      - 1조: A - N - S - Y - Y
      - 2조: N - S - Y - Y - A
      - 3조: S - Y - Y - A - N
      - 4조: Y - Y - A - N - S
      - 5조: Y - A - N - S - Y
      - 6조: A - N - S - Y - Y
      - 7조: N - S - Y - Y - A
      - 8조: S - Y - Y - A - N
      - 9조: Y - Y - A - N - S
      - 10조: Y - A - N - S - Y
  - **근무자**: 주조감독, CMS감독, 예비감독, 영상감독 지정.
  - **제약조건**: 팀당 날짜별 1개의 일지 생성 (Unique Constraint).
  - **댓글 알림**: 업무일지 뷰에서 AI 요약문 옆에 댓글 개수(💬 3) 표시.

  ### 3.2 채널 및 운행 관리
- **채널별 송출사항**
  - **대상 채널**: MBC SPORTS+, MBC Every1, MBC DRAMA, MBC M, MBC ON.
  - **운행표 등록**: 각 채널별 1~5회 등록 횟수 관리.
  - **내용 관리**: 관련 내용 및 추가 내용 입력/수정/삭제.
  - **포스트 연동**: 업무일지 글작성 클릭하면 통합 포스트 작성 및 자동 연결. 작성완료하면 업무일지에 AI요약글 표시.
  - **장비 및 시스템**:장비/시스템 주요사항 및 추가 이슈 기록.
   - 관련 내용 및 추가 내용 입력/수정/삭제.
   -'메모 추가' 버튼을 통해 통합 포스트 작성 및 자동 연결.

  ### 3.3 업무확인 서명 시스템 (Updated)
- **업무확인 서명 시스템**
  - **4명 서명**: 운행 파트, 팀장 파트, MCR 파트, Network 파트.
  - **모니터링**: 각 파트별 서명 상태 및 진행률(%) 실시간 표시.
  - **기록**: 서명자 정보(ID) 및 서명 완료 시점(Timestamp) 저장.
- **상태 관리**
  - `Draft` (임시저장) <-> `Published` (발행) 상태 전환.


## 4. 콘텐츠 관리 (통합 포스트 시스템) (New)
### 4.1 통합 모델
- **Post 모델**: 채널 메모, 시스템 메모, 일반 게시글, 답글 등 모든 '글'을 통합 관리.
- **필드**: 제목, 본문(Rich Text), 요약(Summary), 작성자, 연결된 Worklog(Optional), Parent(답글용).

### 4.2 작성 경로 및 연결
- **빠른 메모**: 업무일지 화면 체크박스 클릭 -> 팝업으로 즉시 작성 (현재 Worklog 자동 연결).
- **일반 글**: 통합 목록에서 작성
- **과거 메모**: 과거 업무일지 목록에서 특정 Worklog 선택 후 작성 (해당 Worklog 연결).
- **선택적 연결**: 작성/수정 시 Worklog 연결/해제 자유로움.

### 4.3 계층형 답글
- **댓글 (Comment)**: 간단한 텍스트 의견.
- **답글 (Post)**: 독립적인 글로서의 답글 (Post의 parent 필드 활용). 공식 후속 조치 보고서 등에 활용.

- **포스트 관리**
  - **에디터**: React Quill 기반의 Rich Text Editor (HTML 지원).
  - **분류**: 카테고리 및 태그 시스템 적용.
  - **작성자**: 개인 또는 팀 단위 작성자 구분.
- **채널 연동**
  - 업무일지의 ChannelBroadcast와 1:1 연동 지원.
  - 연동된 글의 요약 텍스트 표시 설정.
- **AI 통합 (Smart Features)**
  - **서비스**: `posts/ai_service.py` 연동.
  - **기능**: 게시글 내용 요약, 재정리, AI 처리 상태 추적.
- **커뮤니티 기능**
  - 조회수 트래킹, 추천(좋아요) 기능.
  - 계층형(대댓글) 댓글 시스템.

### 4.4 첨부파일 관리
- **대상**: WorkLog 또는 ChannelBroadcast에 파일 첨부.
- **지원 형식**: 이미지(Image), 문서(Document).
- **제한**: 파일당 최대 20MB.
- **보안**: MIME 타입 검증 및 업로드 경로 자동 관리.


## 5. AI 및 통계/대시보드 (New)

### 5.1 AI 기능
- **LLM 자동 요약**: Post 저장 시 백엔드 LLM API 호출 -> 본문 20자 내외 요약 -> `summary` 필드 저장. (A4 출력용)

### 5.2 대시보드
- **일일 현황**
  - 당일 근무조 및 담당자 정보, 근무 시간대 표시.
  - 채널별 운행표 등록 현황 및 실시간 이슈 모니터링.
  - 4개 파트별 서명 완료 상태 및 미서명 알림.
  - 당일 주요 이슈 요약 (긴급도별).

### 5.2 통계 및 분석
  - **운행 분석**: 채널별 등록 횟수 분포, 시간대별 패턴.
  - **이슈 분석**: 장비/시스템 이슈 빈도 및 트렌드.
  - **통계 차트**: 주/월/분기/년별 운행표 등록 횟수, 카테고리/태그 사용 빈도 시각화.
  - **업무 통계**: 월별/주별 일지 작성 현황, 담당자별 업무량.

## 6. 시스템 설정(중요)
- **근무조 및 패턴 관리**:
  - **유연성**: 근무조의 구성원과 근무 패턴(순서, 주기 등)은 변경될 수 있음.
  - **관리 기능**: 관리자가 팀 구성 및 ANSYY 패턴 순서/주기를 설정 페이지에서 변경 가능. 즉시 반영.
    - 팀별 근무자 구성 (이동, 추가, 제외).
    - 근무 패턴 순서 및 주기 (예: ANSYY 패턴 변경 등).
    - 반영시점 설정 관리 (예: 2025년 11월 24일 10:00).
  - **적용**: 변경된 설정은 즉시 또는 지정된 시점부터 일지 생성 로직에 반영되어야 함.

- **업무일지 포맷 작성 관리**:
  - **유연성**: 업무일지 포맷은 변경될 수 있음.
  - **관리 기능**: 관리자가 업무일지 포맷을 설정 페이지에서 변경 가능. 즉시 반영.
    - 업무일지 포맷 (예: A4 출력용).
    - 반영시점 설정 관리 (예: 2025년 11월 24일 10:00).
  - **적용**: 변경된 설정은 즉시 또는 지정된 시점부터 일지 생성 로직에 반영되어야 함.

## 7. 비기능적 요구사항
- **성능**: 페이지 로딩 3초 이내.
- **UI/UX**: 반응형 디자인, 다크 모드(Deep Dark Minimalist), 직관적인 레이아웃.
- **보안**: RBAC, 민감 정보 암호화, 파일 업로드 보안.
