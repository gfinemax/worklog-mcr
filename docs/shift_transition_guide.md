# 근무 패턴 변경 가이드 및 UX 제언 (Shift Pattern Transition & UX Guide)

본 문서는 5교대에서 3교대 전환 등, 근무 조의 개수나 순환 주기가 근본적으로 변경될 때 시스템을 안전하게 설정하는 방법과 사용자 경험(UX)을 개선하기 위한 제언을 담고 있습니다.

---

## 1. UX 관점의 제언 (UX Advice)
사용자가 복잡한 설정을 직관적으로 처리하고 실수를 방지할 수 있도록 다음과 같은 인터페이스 및 흐름을 제안합니다.

### A. "패턴 변경 마법사" (Shift Change Wizard) 도입
설정 페이지의 입력 필드를 직접 수정하는 방식은 실수할 위험이 큽니다. 대신 **"근무 형태 변경하기"** 버튼을 통해 단계별로 질문하고 답하는 **마법사(Wizard) UI**를 제공하는 것이 가장 직관적입니다.

*   **① 변경 시점 선택 (When)**
    *   질문: "언제부터 새로운 근무 패턴이 적용되나요?"
    *   UI: 달력에서 날짜 선택 (예: 2025년 1월 1일)
    *   효과: 시스템의 `valid_from` (기준일)을 자동으로 설정하여 과거 데이터 훼손 방지.

*   **② 주기 및 조 설정 (Structure)**
    *   질문: "몇 개 조가, 며칠 주기로 돌아가나요?"
    *   UI: 조 개수 선택 (5 -> 3), 주기 입력 (10일 -> 6일)
    *   효과: `cycle_length` 자동 설정.

*   **③ 팀원 재배치 (Re-organization)**
    *   질문: "사라지는 4조, 5조 인원을 어디로 이동시킬까요?"
    *   UI: 좌측에 '미배치 인원', 우측에 '새로운 1, 2, 3조'를 두고 드래그 앤 드롭으로 일괄 이동.
    *   효과: `group_members` 테이블 업데이트를 시각적으로 처리.

*   **④ 패턴 매칭 (Pattern Matching)**
    *   질문: "변경일(1월 1일)의 근무 조는 어디인가요?"
    *   UI: 1월 1일의 주간/야간 조만 선택하면, 나머지 패턴을 자동으로 계산하여 미리보기 제공.

### B. 시각적 타임라인 (Visual Timeline)
설정 화면 상단에 **타임라인**을 배치하여, 패턴의 유효 기간을 시각적으로 보여줍니다.
*   `[ ~ 2024.12.31 (5교대/10일 주기) ]` ──▶ `[ 2025.01.01 ~ (3교대/6일 주기) ]`
*   사용자가 "과거 데이터를 건드리는 것 아닐까?" 하는 불안감을 해소해 줍니다.

### C. 시뮬레이션 및 확정 (Simulation & Commit)
저장 버튼을 누르기 전, **"변경 전/후 비교"** 팝업을 띄웁니다.
*   "1월 1일 근무가 **1조 주간**에서 **3조 야간**으로 변경됩니다. 맞습니까?"
*   사용자가 구체적인 결과를 확인하고 "확정"할 수 있게 합니다.

---

## 2. 기술적 적용 가이드 (Technical Implementation)

### 단계 1: 데이터 보존 원칙
*   **기준일(Anchor Date) 활용**: 모든 패턴 변경은 반드시 미래의 특정 날짜(`valid_from`)를 기점으로 새로운 `shift_pattern_config` 레코드를 생성해야 합니다. 기존 레코드를 수정하면 안 됩니다.
*   **근무조(Group) 관리**: 
    *   5교대 -> 3교대 축소 시, 기존 '4조', '5조'를 삭제하지 말고 **비활성화(Archived)** 처리하거나 멤버를 0명으로 만듭니다.
    *   필요하다면 '신규 1조' 등을 생성할 수도 있지만, 기존 이름을 유지하고 멤버만 이동시키는 것이 사용자 혼란을 줄일 수 있습니다.

### 단계 2: 데이터베이스 처리
1.  **멤버 이동**: `group_members` 테이블에서 기존 4, 5조 멤버의 `group_id`를 1~3조로 업데이트합니다.
2.  **새 설정 생성**: `shift_pattern_configs` 테이블에 `INSERT` 합니다.
    *   `valid_from`: '2025-01-01'
    *   `cycle_length`: 6
    *   `pattern_json`: 새 패턴 데이터

### 단계 3: 검증
*   `shiftService.calculateShift()` 함수는 요청된 날짜가 `valid_from` 이후인 경우 자동으로 새 설정을 참조하므로, 별도의 로직 변경 없이도 1월 1일부터 새 패턴이 적용됩니다.

---

## 3. 데이터 보존 및 이력 관리 (Data Preservation & Audit)

사용자의 요청대로, 근무자가 탈퇴하거나 패턴이 변경되어도 **과거의 기록은 절대 변하지 않아야 하며**, **변경 이력**은 투명하게 관리되어야 합니다.

### A. 데이터 보존 원칙 (Preservation Principles)
1.  **스냅샷 저장 (Snapshotting)**:
    *   업무일지(`worklogs`)나 근무 세션(`work_sessions`)이 생성될 때, 당시의 근무자 정보(이름, 직급 등)를 별도의 컬럼이나 테이블(`work_session_members`)에 **텍스트 형태로 복사**해 둡니다.
    *   이렇게 하면 원본 `users` 테이블에서 정보가 변경되거나 삭제되어도, 과거 일지에는 영향이 없습니다.
2.  **소프트 삭제 (Soft Delete)**:
    *   근무자가 퇴사하더라도 DB에서 `DELETE` 하지 않고, `is_active = false` 또는 `deleted_at` 타임스탬프를 찍어 **비활성화**만 합니다.
    *   시스템에서는 '활성 사용자'만 조회되지만, DB에는 데이터가 남아있어 무결성이 유지됩니다.

### B. 사용자 중심의 이력 공유: "MCR 타임라인" (MCR Timeline)
단순한 관리자용 감시 로그가 아니라, **모든 근무자가 시스템의 변화를 이해하고 흐름을 파악할 수 있는 "정보 공유의 장"**으로 제안합니다.

*   **명칭 제안**: **"MCR 히스토리"** 또는 **"운영 타임라인"**
*   **기능 및 UX 아이디어**:
    1.  **타임라인 뷰 (Timeline View)**:
        *   Facebook이나 Instagram의 피드처럼, 시간 순으로 주요 변경 사항을 보여줍니다.
        *   *예: "2025.01.01 - 3교대 시스템이 시작되었습니다."*
        *   *예: "2024.12.15 - 홍길동님이 1조에 합류했습니다."*
    2.  **맥락 정보 제공 (Contextual Banner)**:
        *   과거(예: 5교대 시절)의 업무일지를 조회할 때, 상단에 배너를 띄워줍니다.
        *   *알림: "이 일지는 5교대 순환 근무 당시에 작성되었습니다."*
        *   이를 통해 사용자는 과거 데이터가 현재와 다름을 자연스럽게 인지하고, 실수를 방지할 수 있습니다.
    3.  **검색 및 필터**:
        *   특정 근무자의 이동 이력이나, 특정 기간의 근무 패턴을 쉽게 찾아볼 수 있습니다.

---

가장 중요한 것은 **"사용자가 실수로 과거의 패턴을 덮어쓰지 않도록 하는 것"**입니다. 이를 위해 **마법사 UI**를 통해 "새로운 시작일"을 명확히 입력받고, 그 시점부터 새로운 설정이 생성됨을 시각적으로 인지시켜 주는 것이 UX의 핵심입니다. 또한, **스냅샷**과 **소프트 삭제**를 통해 데이터의 영속성을 보장하고, **MCR 타임라인**을 통해 변경 이력을 투명하게 공유함으로써 구성원 전체의 이해도를 높일 수 있습니다.

---

## 5. 추가 제언 (Advanced Ideas)
사용자 편의성과 시스템 안정성을 극대화하기 위한 추가적인 아이디어입니다.

### A. "샌드박스 모드" (Sandbox Mode)
*   **개념**: 실제 데이터에 영향을 주지 않고 마음껏 설정을 변경하고 시뮬레이션해 볼 수 있는 '연습장' 기능입니다.
*   **UX**: "샌드박스 모드 켜기" 스위치를 제공하여, UI 테마를 약간 변경(예: 테두리 색상 변경)해 연습 중임을 알립니다.
*   **효과**: 관리자가 부담 없이 다양한 시나리오를 테스트해 볼 수 있습니다.

### B. "패턴 템플릿" (Pattern Templates)
*   **개념**: 자주 쓰이는 근무 형태를 프리셋으로 제공합니다.
*   **예시**: `[4조 3교대]`, `[3조 2교대]`, `[주간 고정]` 등.
*   **효과**: 복잡한 `pattern_json`을 일일이 설정할 필요 없이, 템플릿 선택 후 미세 조정만 하면 되므로 설정 시간이 단축됩니다.

### C. "영향도 분석 리포트" (Impact Analysis)
*   **개념**: 변경 사항 저장 전, 구체적인 영향 범위를 수치로 보여줍니다.
*   **메시지 예시**:
    *   *"이 변경으로 인해 **2025년**의 근무표가 재계산됩니다."*
    *   *"총 **15명**의 근무자 소속이 변경됩니다."*
    *   *"작성 중인 업무일지 **3건**이 영향을 받을 수 있습니다."*

### D. "자동 알림 발송" (Auto-Notification)
*   **개념**: 중요한 패턴 변경이 확정되면, 영향을 받는 근무자들에게 자동으로 알림을 보냅니다.
*   **내용**: "2025년 1월 1일부터 근무 패턴이 변경됩니다. MCR 타임라인을 확인해주세요."
