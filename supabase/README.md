# MCR ì—…ë¬´ì¼ì§€ ì‹œìŠ¤í…œ - Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ í´ë”ëŠ” MCR ì—…ë¬´ì¼ì§€ ì‹œìŠ¤í…œì˜ Supabase ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë° ì´ˆê¸° ì„¤ì • íŒŒì¼ì„ í¬í•¨í•©ë‹ˆë‹¤.

## ğŸ—‚ï¸ íŒŒì¼ êµ¬ì¡°

```
supabase/
â””â”€â”€ migrations/
    â”œâ”€â”€ 01_create_tables.sql      # í…Œì´ë¸” ìƒì„±
    â”œâ”€â”€ 02_rls_policies.sql       # RLS ë³´ì•ˆ ì •ì±…
    â”œâ”€â”€ 03_triggers.sql           # íŠ¸ë¦¬ê±° ë° ìë™í™”
    â””â”€â”€ 04_seed_data.sql          # ì´ˆê¸° ë°ì´í„°
```

## ğŸš€ ì„¤ì¹˜ ë°©ë²•

### ë°©ë²• 1: Supabase Dashboardì—ì„œ ì§ì ‘ ì‹¤í–‰

1. [Supabase Dashboard](https://app.supabase.com) ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ **SQL Editor** ì„ íƒ
4. ë‹¤ìŒ ìˆœì„œëŒ€ë¡œ SQL íŒŒì¼ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ì‹¤í–‰:
   - `01_create_tables.sql`
   - `02_rls_policies.sql`
   - `03_triggers.sql`
   - `04_seed_data.sql`

### ë°©ë²• 2: Supabase CLI ì‚¬ìš© (ê¶Œì¥)

```bash
# 1. Supabase CLI ì„¤ì¹˜ (ì•„ì§ ì„¤ì¹˜í•˜ì§€ ì•Šì•˜ë‹¤ë©´)
npm install -g supabase

# 2. Supabase í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
supabase init

# 3. ë¡œì»¬ì—ì„œ Supabase ì‹¤í–‰
supabase start

# 4. ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì ìš©
supabase db reset

# 5. ì›ê²© í”„ë¡œë•ì…˜ì— ì ìš©
supabase db push
```

## ğŸ“Š ìƒì„±ë˜ëŠ” í…Œì´ë¸”

### 1. **users** - ì‚¬ìš©ì í”„ë¡œí•„
- auth.usersì™€ 1:1 ì—°ê²°
- ì´ë¦„, ì—­í• , PIN ì½”ë“œ, í”„ë¡œí•„ ì´ë¯¸ì§€ ë“±

### 2. **support_staff** - ì§€ì› ì¸ë ¥
- ì™¸ë¶€ ìˆœí™˜ ê·¼ë¬´ì ì •ë³´

### 3. **roles** - ê·¼ë¬´ ì—­í• 
- ê°ë…, ë¶€ê°ë…, ì˜ìƒ ë“± ì—­í•  ì •ì˜

### 4. **groups** - ê·¼ë¬´ì¡°
- 1ì¡°, 2ì¡° ë“± ê·¼ë¬´ì¡° ì •ë³´

### 5. **group_members** - ê·¼ë¬´ì¡° ë©¤ë²„
- ê° ê·¼ë¬´ì¡°ì˜ ê³ ì • ë©¤ë²„

### 6. **work_sessions** - ì‹¤ì œ ê·¼ë¬´ ì„¸ì…˜
- ë‚ ì§œë³„ ì‹¤ì œ ê·¼ë¬´ ê¸°ë¡

### 7. **work_session_members** - ì„¸ì…˜ ë©¤ë²„ ìŠ¤ëƒ…ìƒ·
- íŠ¹ì • ì„¸ì…˜ì˜ ì‹¤ì œ ê·¼ë¬´ì (êµì²´ ì •ë³´ í¬í•¨)

### 8. **worklogs** - ì—…ë¬´ì¼ì§€
- ê¸°ì¡´ ë¡œì»¬ ìŠ¤í† ì–´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ìš©

## ğŸ”’ ë³´ì•ˆ ì„¤ì • (RLS)

ëª¨ë“  í…Œì´ë¸”ì— Row Level Securityê°€ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

- âœ… ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ë°ì´í„° ì ‘ê·¼ ê°€ëŠ¥
- âœ… ìµëª… ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ ì‹œ í•„ìš”í•œ ìµœì†Œí•œì˜ ì½ê¸° ê¶Œí•œë§Œ ë¶€ì—¬
- âœ… ì‚¬ìš©ìëŠ” ë³¸ì¸ì˜ ë°ì´í„°ë§Œ ìˆ˜ì • ê°€ëŠ¥

## ğŸ¤– ìë™í™” íŠ¸ë¦¬ê±°

### 1. ì‹ ê·œ ì‚¬ìš©ì í”„ë¡œí•„ ìë™ ìƒì„±
- auth.usersì— ì‚¬ìš©ìê°€ ì¶”ê°€ë˜ë©´ ìë™ìœ¼ë¡œ public.usersì— í”„ë¡œí•„ ìƒì„±

### 2. Google OAuth í”„ë¡œí•„ ë™ê¸°í™”
- Google ë¡œê·¸ì¸ ì‹œ í”„ë¡œí•„ ì´ë¯¸ì§€ ë° ì´ë¦„ ìë™ ì—…ë°ì´íŠ¸

### 3. ì„¸ì…˜ ì¢…ë£Œ ì‹œê°„ ìë™ ì„¤ì •
- work_sessionsì˜ statusê°€ 'completed'ë¡œ ë³€ê²½ë˜ë©´ end_time ìë™ ì„¤ì •

### 4. ì‚¬ìš©ì ì‚­ì œ ì‹œ ì—°ê´€ ë°ì´í„° ì •ë¦¬
- CASCADE ì‚­ì œë¡œ ê´€ë ¨ ë°ì´í„° ìë™ ì •ë¦¬

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„°

`04_seed_data.sql`ì—ëŠ” ë‹¤ìŒ í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

- ê¸°ë³¸ ì—­í•  (ê°ë…, ë¶€ê°ë…, ì˜ìƒ ë“±)
- 5ê°œì˜ í…ŒìŠ¤íŠ¸ ê·¼ë¬´ì¡° (1ì¡° ~ 5ì¡°)
- 3ëª…ì˜ í…ŒìŠ¤íŠ¸ ì§€ì› ì¸ë ¥

âš ï¸ **ì£¼ì˜**: ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì œê±°í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ì„¸ìš”.

## ğŸ”§ í™˜ê²½ ë³€ìˆ˜ í™•ì¸

`.env.local` íŒŒì¼ì— ë‹¤ìŒ í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:

```env
NEXT_PUBLIC_SUPABASE_URL=your-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

## ğŸ› ë¬¸ì œ í•´ê²°

### "Auth Error: Database error querying schema"

**ì›ì¸**: `users` í…Œì´ë¸”ì´ ì—†ê±°ë‚˜ RLS ì •ì±…ì´ ì˜ëª» ì„¤ì •ë¨

**í•´ê²°**:
1. `01_create_tables.sql` ì‹¤í–‰ í™•ì¸
2. `02_rls_policies.sql` ì‹¤í–‰ í™•ì¸
3. Supabase Dashboard â†’ Table Editorì—ì„œ `users` í…Œì´ë¸” ì¡´ì¬ í™•ì¸
4. RLS ì •ì±…ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸

### íšŒì›ê°€ì… ì‹œ í”„ë¡œí•„ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ

**ì›ì¸**: íŠ¸ë¦¬ê±°ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
1. `03_triggers.sql` ì‹¤í–‰ í™•ì¸
2. Supabase Dashboard â†’ Database â†’ Triggersì—ì„œ `on_auth_user_created` í™•ì¸

### RLS ì •ì±…ìœ¼ë¡œ ì¸í•œ ì ‘ê·¼ ê±°ë¶€

**ì›ì¸**: ì˜ëª»ëœ RLS ì •ì±… ì„¤ì •

**í•´ê²°**:
1. `02_rls_policies.sql` ì¬ì‹¤í–‰
2. Supabase Dashboard â†’ Authentication â†’ Policiesì—ì„œ ì •ì±… í™•ì¸

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [Supabase Documentation](https://supabase.com/docs)
- [Row Level Security Guide](https://supabase.com/docs/guides/auth/row-level-security)
- [Database Migrations](https://supabase.com/docs/guides/cli/local-development#database-migrations)

## ğŸ“ ë¬¸ì˜

ë¬¸ì œê°€ ì§€ì†ë˜ë©´ í”„ë¡œì íŠ¸ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
